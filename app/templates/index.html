 <!DOCTYPE html>
<html lang="fr">
 <head>
     <meta charset="UTF-8">
     <title>Traduction et doublage vidéo</title>
     <link rel="stylesheet" href="/static/style.css">
 </head>
 <body>
 <h1>Traduction et doublage vidéo</h1>
 {% if is_editor %}
 <div id="role-indicator" style="background: #007bff; color: white; padding: 10px; margin-bottom: 20px;">
     Mode Éditeur actif
 </div>
 {% else %}
 <div id="role-indicator" style="background: #28a745; color: white; padding: 10px; margin-bottom: 20px;">
     Mode Public actif
 </div>
 {% endif %}
 
 {% if is_editor %}
 <section id="upload" style="display: block;">
     <h2>Télécharger et traiter un fichier</h2>
     <form id="upload-form">
        <fieldset>
            <legend>Type de fichier</legend>
            <label>
                <input type="radio" name="file_type" value="video" checked>
                Vidéo
            </label>
            <label>
                <input type="radio" name="file_type" value="audio">
                Audio
            </label>
            <label>
                <input type="radio" name="file_type" value="text">
                Texte
            </label>
        </fieldset>
        <fieldset>
            <legend>Dossier (optionnel)</legend>
            <label>
                Dossier :
                <select name="folder_path" id="folder-path-select">
                    <option value="">Aucun dossier (racine)</option>
                </select>
            </label>
        </fieldset>
         <div class="file-upload">
             <label class="file-upload-label" id="file-type-label">Fichier vidéo :</label>
             <input type="file" name="file" id="video-file" accept="video/*" class="file-upload-input" required>
             <button type="button" class="file-upload-trigger" onclick="document.getElementById('video-file').click()">Choisir un fichier</button>
             <span class="file-upload-name" id="selected-file-name">Aucun fichier sélectionné</span>
         </div>
         <fieldset id="processing-options-fieldset">
             <legend>Options de traitement</legend>
             <div id="video-options">
                 <label>
                     <input type="checkbox" name="process_options" value="subs" checked>
                     Télécharger les sous-titres
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="dub_audio" checked>
                     Audio de doublage (MP3)
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="dub_video" checked>
                     Vidéo avec doublage audio
                 </label>
             </div>
             <div id="audio-options" style="display: none;">
                 <label>
                     <input type="checkbox" name="process_options" value="transcribe" checked>
                     Transcrire (audio → texte)
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="improve_text">
                     Améliorer le texte (avec IA)
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="translate">
                     Traduire
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="generate_audio">
                     Générer audio (texte → audio)
                 </label>
             </div>
             <div id="text-options" style="display: none;">
                 <label>
                     <input type="checkbox" name="process_options" value="improve_text" checked>
                     Améliorer le texte (avec IA)
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="translate" checked>
                     Traduire
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="generate_audio">
                     Générer audio (texte → audio)
                 </label>
             </div>
            <p class="language-hint">Décochez les options inutiles pour éviter un traitement superflu.</p>
         </fieldset>
         <fieldset id="languages-fieldset">
             <legend>Langues cibles (max. 2)</legend>
             {% for lang in available_languages %}
             <label>
                 <input type="checkbox" name="languages" value="{{ lang.code }}">
                 {{ lang.label }}{% if lang.provider == "ai" %}*{% endif %}
             </label>
             {% endfor %}
             <p class="language-hint">Les langues marquées d'un * utilisent le traducteur IA, les autres passent par DeepL.</p>
             <p class="language-hint">Lingala, Tshiluba, Kikongo et Malagasy ne proposent pour l'instant que des sous-titres.</p>
         </fieldset>
         <fieldset id="source-language-fieldset" style="display: none;">
             <legend>Langue source</legend>
             <label>
                 Langue du fichier :
                 <select name="source_language" id="source-language-select">
                     <option value="fr">Français</option>
                     <option value="nl">Néerlandais</option>
                     <option value="en">Anglais</option>
                     <option value="es">Espagnol</option>
                     <option value="pt">Portugais</option>
                 </select>
             </label>
         </fieldset>
        <fieldset id="tts-speed-fieldset">
            <legend>Synchronisation du doublage</legend>
            <label>
                Vitesse relative de la voix TTS
                <input
                    type="number"
                    name="tts_speed_multiplier"
                    value="1.05"
                    min="0.8"
                    max="1.2"
                    step="0.01"
                >
            </label>
            <p class="language-hint">
                1,00 = vitesse normale. Augmentez légèrement (ex. 1,05) pour que la voix doublée démarre plus tôt.
            </p>
        </fieldset>
        <button type="submit">Téléverser et traiter</button>
    </form>
     <div id="upload-status"></div>
 </section>
 {% else %}
 <section id="upload" style="display: none;"></section>
 {% endif %}
 
 <hr>
 
 <section id="library">
     <h2>Bibliothèque</h2>
     <div id="video-list"></div>
     {% if is_editor %}
     <div id="folder-management" style="margin-top: 20px;">
         <button type="button" id="create-folder-btn">Créer un nouveau dossier</button>
     </div>
     {% endif %}
 </section>
 
 <section id="player">
     <h2>Lecteur</h2>
     <div id="video-container">
         <video id="video-player" controls width="800">
             Votre navigateur ne supporte pas la balise vidéo.
         </video>
         <div id="subtitle-overlay" class="hidden"></div>
     </div>
     <div id="player-actions">
         <button type="button" id="fullscreen-button">[ ] Plein écran</button>
     </div>
     <div id="player-info"></div>
 </section>
 
 <script src="/static/app.js"></script>
 </body>
 </html>
