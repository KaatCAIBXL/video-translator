 <!DOCTYPE html>
<html lang="fr">
 <head>
     <meta charset="UTF-8">
     <title>Traduction et doublage vid√©o</title>
     <link rel="stylesheet" href="/static/style.css">
 </head>
 <body>
 <h1>Traduction et doublage vid√©o</h1>
 {% if is_admin %}
 <div id="role-indicator" style="background: #dc3545; color: white; padding: 10px; margin-bottom: 20px;">
     Mode de admin actif
 </div>
 {% elif is_editor %}
 <div id="role-indicator" style="background: #007bff; color: white; padding: 10px; margin-bottom: 20px;">
     Mode I-tech priv√© actif
 </div>
 {% else %}
 <div id="role-indicator" style="background: #28a745; color: white; padding: 10px; margin-bottom: 20px;">
     Mode les saints de MAI actif
 </div>
 {% endif %}
 
 {% if is_editor %}
 <!-- Character Management (Dreambooth) -->
 <section id="characters-section" style="display: block; margin-bottom: 30px; padding: 20px; border: 2px solid #007bff; background: #f0f8ff;">
     <h2>üë§ Gestion des Personnages</h2>
     <button type="button" id="create-character-btn" style="margin-bottom: 20px; padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
         + Personnage
     </button>
     <div id="characters-list"></div>
     
     <!-- Character Creation Modal -->
     <div id="character-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
         <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
             <h3>Cr√©er un nouveau personnage</h3>
             <form id="character-form">
                 <label style="display: block; margin-top: 15px;">
                     Nom du personnage :
                     <input type="text" name="name" id="character-name" required style="width: 100%; padding: 8px; margin-top: 5px;">
                 </label>
                 <label style="display: block; margin-top: 15px;">
                     Token unique (minuscules, lettres/chiffres/underscores) :
                     <input type="text" name="token" id="character-token" required pattern="[a-z0-9_]+" style="width: 100%; padding: 8px; margin-top: 5px;">
                     <small style="color: #666;">Exemple: joepenna, bingo, personnage1</small>
                 </label>
                 <label style="display: block; margin-top: 15px;">
                     Description (caract√©ristiques) :
                     <textarea name="description" id="character-description" rows="3" style="width: 100%; padding: 8px; margin-top: 5px;" placeholder="Exemple: lief, lachend, dynamisch, oud, pastor"></textarea>
                 </label>
                 <label style="display: block; margin-top: 15px;">
                     Classe (person, dog, etc.) :
                     <input type="text" name="class_word" id="character-class" value="person" required style="width: 100%; padding: 8px; margin-top: 5px;">
                 </label>
                 <div style="margin-top: 20px;">
                     <button type="submit" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                         Cr√©er
                     </button>
                     <button type="button" id="cancel-character-btn" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">
                         Annuler
                     </button>
                 </div>
             </form>
         </div>
     </div>
     
     <!-- Character Detail Modal -->
     <div id="character-detail-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
         <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto;">
             <h3 id="character-detail-name"></h3>
             <div id="character-detail-content"></div>
             <button type="button" id="close-character-detail-btn" style="margin-top: 20px; padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">
                 Fermer
             </button>
         </div>
     </div>
 </section>

 <!-- Text-to-Video Generation (Hidden Feature) -->
 <section id="text-to-video-section" style="display: none; margin-bottom: 30px; padding: 20px; border: 2px dashed #ccc; background: #f9f9f9;">
     <h2>üé¨ G√©n√©rer une vid√©o √† partir de texte (Stable Diffusion)</h2>
     <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">
         Cette fonctionnalit√© g√©n√®re une vid√©o √† partir de texte en utilisant Stable Diffusion WebUI et des mod√®les Dreambooth.
     </p>
     <form id="text-to-video-form">
         <fieldset>
             <legend>Texte</legend>
             <label>
                 Texte √† convertir en vid√©o :
                 <textarea name="text" id="text-to-video-input" rows="5" style="width: 100%; padding: 8px; font-family: inherit;" placeholder="Entrez le texte ici..."></textarea>
             </label>
         </fieldset>
         <fieldset>
             <legend>Personnage (optionnel)</legend>
             <label>
                 S√©lectionner un personnage :
                 <select name="character_id" id="text-to-video-character" style="width: 100%; padding: 8px;">
                     <option value="">Aucun personnage</option>
                 </select>
             </label>
             <p style="font-size: 0.9em; color: #666; margin-top: 5px;">
                 Les personnages entra√Æn√©s seront automatiquement utilis√©s dans la g√©n√©ration.
             </p>
         </fieldset>
         <fieldset>
             <legend>Param√®tres</legend>
             <label>
                 Mod√®le Dreambooth (optionnel, ignor√© si un personnage est s√©lectionn√©) :
                 <input type="text" name="model_name" id="text-to-video-model" placeholder="Nom du mod√®le (laisser vide pour le mod√®le par d√©faut)" style="width: 100%; padding: 8px;">
             </label>
             <label style="margin-top: 10px; display: block;">
                 <input type="checkbox" name="image_per_sentence" id="text-to-video-sentence" checked>
                 G√©n√©rer une image par phrase
             </label>
         </fieldset>
         <fieldset>
             <legend>Dossier (optionnel)</legend>
             <label>
                 Dossier :
                 <select name="folder_path" id="text-to-video-folder">
                     <option value="">Aucun dossier (racine)</option>
                 </select>
             </label>
         </fieldset>
         <fieldset>
             <legend>Confidentialit√©</legend>
             <label>
                 <input type="checkbox" name="is_private" id="text-to-video-private">
                 Fichier priv√© (visible uniquement par les √©diteurs)
             </label>
         </fieldset>
         <button type="submit" id="text-to-video-submit" style="margin-top: 15px; padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
             G√©n√©rer la vid√©o
         </button>
     </form>
     <div id="text-to-video-status" style="margin-top: 15px; padding: 10px; display: none;"></div>
 </section>

 <section id="upload" style="display: block;">
     <h2>T√©l√©charger et traiter un fichier</h2>
     <form id="upload-form">
        <fieldset>
            <legend>Type de fichier</legend>
            <label>
                <input type="radio" name="file_type" value="video" checked>
                Vid√©o
            </label>
            <label>
                <input type="radio" name="file_type" value="audio">
                Audio
            </label>
            <label>
                <input type="radio" name="file_type" value="text">
                Texte
            </label>
        </fieldset>
        <fieldset>
            <legend>Dossier (optionnel)</legend>
            <label>
                Dossier :
                <select name="folder_path" id="folder-path-select">
                    <option value="">Aucun dossier (racine)</option>
                </select>
            </label>
        </fieldset>
         <div class="file-upload">
             <label class="file-upload-label" id="file-type-label">Fichier vid√©o :</label>
             <input type="file" name="file" id="video-file" accept="video/*" class="file-upload-input" multiple required>
             <button type="button" class="file-upload-trigger" id="file-upload-button">Choisir un fichier</button>
             <span class="file-upload-name" id="selected-file-name">Aucun fichier s√©lectionn√©</span>
         </div>
         <fieldset id="processing-options-fieldset">
             <legend>Options de traitement</legend>
             <div id="video-options">
                 <label>
                     <input type="checkbox" name="process_options" value="transcribe">
                     Transcrire (vid√©o ‚Üí texte)
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="subs" checked>
                     T√©l√©charger les sous-titres
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="dub_audio" checked>
                     Audio de doublage (MP3)
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="dub_video" checked>
                     Vid√©o avec doublage audio
                 </label>
             </div>
             <div id="audio-options" style="display: none;">
                 <label>
                     <input type="checkbox" name="process_options" value="transcribe" checked>
                     Transcrire (audio ‚Üí texte)
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="improve_text">
                     Am√©liorer le texte (avec IA)
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="translate">
                     Traduire
                 </label>
             </div>
             <div id="text-options" style="display: none;">
                 <label>
                     <input type="checkbox" name="process_options" value="improve_text" checked>
                     Am√©liorer le texte (avec IA)
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="translate" checked>
                     Traduire
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="generate_audio">
                     G√©n√©rer audio (texte ‚Üí audio)
                 </label>
             </div>
            <p class="language-hint">D√©cochez les options inutiles pour √©viter un traitement superflu.</p>
         </fieldset>
         <fieldset id="languages-fieldset">
             <legend>Langues cibles (max. 2)</legend>
             {% for lang in available_languages %}
             <label>
                 <input type="checkbox" name="languages" value="{{ lang.code }}">
                 {{ lang.label }}{% if lang.provider == "ai" %}*{% endif %}
             </label>
             {% endfor %}
             <p class="language-hint">Les langues marqu√©es d'un * utilisent le traducteur IA, les autres passent par DeepL.</p>
             <p class="language-hint">Lingala, Tshiluba, Kikongo et Malagasy ne proposent pour l'instant que des sous-titres.</p>
         </fieldset>
         <fieldset id="source-language-fieldset" style="display: none;">
             <legend>Langue source</legend>
             <label>
                 Langue du fichier :
                 <select name="source_language" id="source-language-select">
                     <option value="fr">Fran√ßais</option>
                     <option value="nl">N√©erlandais</option>
                     <option value="en">Anglais</option>
                     <option value="es">Espagnol</option>
                     <option value="pt">Portugais</option>
                 </select>
             </label>
         </fieldset>
        <fieldset id="tts-speed-fieldset">
            <legend>Synchronisation du doublage</legend>
            <label>
                Vitesse relative de la voix TTS
                <input
                    type="number"
                    name="tts_speed_multiplier"
                    value="1.05"
                    min="0.8"
                    max="1.2"
                    step="0.01"
                >
            </label>
            <p class="language-hint">
                1,00 = vitesse normale. Augmentez l√©g√®rement (ex. 1,05) pour que la voix doubl√©e d√©marre plus t√¥t.
            </p>
        </fieldset>
        <button type="submit">T√©l√©verser et traiter</button>
    </form>
     <div id="upload-status"></div>
 </section>
 {% else %}
 <section id="upload" style="display: none;"></section>
 {% endif %}
 
 <hr>
 
 <section id="library">
     <h2>Biblioth√®que</h2>
     <div id="video-list"></div>
     {% if is_editor %}
     <div id="folder-management" style="margin-top: 20px;">
         <button type="button" id="create-folder-btn">Cr√©er un nouveau dossier</button>
     </div>
     {% endif %}
     
     <!-- Message to Admin Section (for viewers and editors) -->
     {% if not is_admin %}
     <div id="message-to-admin-section" style="margin-top: 30px; padding: 20px; border: 2px solid #ffc107; background: #fff3cd; border-radius: 5px;">
         <h3>üìß Signaler un probl√®me √† l'admin</h3>
         <p style="color: #856404; margin-bottom: 15px;">Vous pouvez envoyer un message √† l'administrateur pour signaler un probl√®me ou poser une question.</p>
         <form id="message-to-admin-form">
             <textarea id="admin-message-input" rows="4" style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 3px;" placeholder="D√©crivez votre probl√®me ou question..."></textarea>
             <button type="submit" style="padding: 10px 20px; background: #ffc107; color: #000; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                 Envoyer le message
             </button>
         </form>
         <div id="message-status" style="margin-top: 10px; display: none;"></div>
     </div>
     {% endif %}
     
     <!-- Admin Messages Section -->
     {% if is_admin %}
     <div id="admin-messages-section" style="margin-top: 30px; padding: 20px; border: 2px solid #dc3545; background: #f8d7da; border-radius: 5px;">
         <h3>üì¨ Messages re√ßus</h3>
         <div id="admin-messages-list" style="margin-top: 15px;">
             <p>Chargement des messages...</p>
         </div>
     </div>
     {% endif %}
 </section>
 
 <section id="player">
     <h2>Lecteur</h2>
     <div id="video-container">
         <video id="video-player" controls width="800">
             Votre navigateur ne supporte pas la balise vid√©o.
         </video>
         <div id="subtitle-overlay" class="hidden"></div>
     </div>
     <div id="player-actions">
         <button type="button" id="fullscreen-button">[ ] Plein √©cran</button>
     </div>
     <div id="player-info"></div>
 </section>
 
 <script src="/static/app.js"></script>
 </body>
 </html>
