 <!DOCTYPE html>
<html lang="fr">
 <head>
     <meta charset="UTF-8">
     <title>Traduction et doublage vid√©o</title>
     <link rel="stylesheet" href="/static/style.css">
 </head>
 <body>
 <h1>Traduction et doublage vid√©o</h1>
 {% if is_admin %}
 <div id="role-indicator" style="background: #dc3545; color: white; padding: 10px; margin-bottom: 20px;">
     Mode de admin actif
 </div>
 {% elif is_editor %}
 <div id="role-indicator" style="background: #007bff; color: white; padding: 10px; margin-bottom: 20px;">
     Mode I-tech priv√© actif
 </div>
 {% else %}
 <div id="role-indicator" style="background: #28a745; color: white; padding: 10px; margin-bottom: 20px;">
     Mode les saints de MAI actif
 </div>
 {% endif %}
 
 {% if can_generate_video %}
 <!-- Text-to-Video Generation (Admin Only) -->
 <section id="text-to-video-section" style="display: block; margin-bottom: 30px; padding: 20px; border: 2px solid #dc3545; background: #f8d7da;">
     <h2>üé¨ G√©n√©rer une vid√©o √† partir de texte (Stable Diffusion) - Admin</h2>
     <p style="color: #721c24; font-size: 0.9em; margin-bottom: 15px;">
         Cette fonctionnalit√© g√©n√®re une vid√©o √† partir de texte en utilisant Stable Diffusion WebUI et des mod√®les Dreambooth.
     </p>
     <form id="text-to-video-form">
         <fieldset>
             <legend>Texte</legend>
             <label>
                 Texte √† convertir en vid√©o :
                 <textarea name="text" id="text-to-video-input" rows="5" style="width: 100%; padding: 8px; font-family: inherit;" placeholder="Entrez le texte ici..."></textarea>
             </label>
         </fieldset>
         <fieldset>
             <legend>Personnage (optionnel)</legend>
             <label>
                 S√©lectionner un personnage :
                 <select name="character_id" id="text-to-video-character" style="width: 100%; padding: 8px;">
                     <option value="">Aucun personnage</option>
                 </select>
             </label>
             <p style="font-size: 0.9em; color: #666; margin-top: 5px;">
                 Les personnages entra√Æn√©s seront automatiquement utilis√©s dans la g√©n√©ration.
             </p>
         </fieldset>
         <fieldset>
             <legend>Param√®tres</legend>
             <label>
                 Mod√®le Dreambooth (optionnel, ignor√© si un personnage est s√©lectionn√©) :
                 <input type="text" name="model_name" id="text-to-video-model" placeholder="Nom du mod√®le (laisser vide pour le mod√®le par d√©faut)" style="width: 100%; padding: 8px;">
             </label>
             <label style="margin-top: 10px; display: block;">
                 <input type="checkbox" name="image_per_sentence" id="text-to-video-sentence" checked>
                 G√©n√©rer une image par phrase
             </label>
         </fieldset>
         <fieldset>
             <legend>Dossier (optionnel)</legend>
             <label>
                 Dossier :
                 <select name="folder_path" id="text-to-video-folder">
                     <option value="">Aucun dossier (racine)</option>
                 </select>
             </label>
         </fieldset>
         <fieldset>
             <legend>Confidentialit√©</legend>
             <label>
                 <input type="checkbox" name="is_private" id="text-to-video-private">
                 Fichier priv√© (visible uniquement par les √©diteurs)
             </label>
         </fieldset>
         <button type="submit" id="text-to-video-submit" style="margin-top: 15px; padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer;">
             G√©n√©rer la vid√©o
         </button>
     </form>
     <div id="text-to-video-status" style="margin-top: 15px; padding: 10px; display: none;"></div>
 </section>
 {% endif %}

 {% if is_admin %}
 <!-- Image Generation with ModelsLab Flux 2 Pro - Admin Only -->
 <section id="image-generation-section" style="display: block; margin-bottom: 30px; padding: 20px; border: 2px solid #007bff; background: #f0f8ff;">
     <h2>üé® G√©n√©rer une image avec Flux 2 Pro (Admin)</h2>
     <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">
         Cr√©ez une image √† partir d'un prompt texte en utilisant ModelsLab Flux 2 Pro Text To Image.
     </p>
     <form id="image-generation-form">
         <fieldset>
             <legend>Prompt</legend>
             <label>
                 Description de l'image :
                 <textarea name="prompt" id="image-prompt-input" rows="4" style="width: 100%; padding: 8px; font-family: inherit;" placeholder="D√©crivez l'image que vous souhaitez g√©n√©rer..." required></textarea>
             </label>
         </fieldset>
         <fieldset>
             <legend>Param√®tres</legend>
             <label style="display: inline-block; margin-right: 20px;">
                 Largeur :
                 <input type="number" name="width" id="image-width" value="1024" min="64" max="2048" step="64" style="width: 100px; padding: 8px;">
             </label>
             <label style="display: inline-block;">
                 Hauteur :
                 <input type="number" name="height" id="image-height" value="1024" min="64" max="2048" step="64" style="width: 100px; padding: 8px;">
             </label>
         </fieldset>
         <button type="submit" id="generate-image-btn" style="margin-top: 15px; padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
             üé® G√©n√©rer l'image
         </button>
     </form>
     <div id="image-generation-status" style="margin-top: 15px; padding: 10px; display: none;"></div>
     <div id="generated-image-container" style="margin-top: 20px; display: none;">
         <h3>Image g√©n√©r√©e :</h3>
         <div id="generated-image-wrapper" style="margin-top: 10px;">
             <img id="generated-image" src="" alt="Generated image" style="max-width: 100%; border: 1px solid #ddd; border-radius: 5px;">
         </div>
         <div style="margin-top: 10px;">
             <a id="download-image-link" href="" download style="padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 5px; display: inline-block;">
                 üì• T√©l√©charger l'image
             </a>
         </div>
     </div>
 </section>
 {% endif %}

 <!-- Text-to-Video Generation (Hidden Feature) -->
 <section id="text-to-video-section" style="display: none; margin-bottom: 30px; padding: 20px; border: 2px dashed #ccc; background: #f9f9f9;">
     <h2>üé¨ G√©n√©rer une vid√©o √† partir de texte (Stable Diffusion)</h2>
     <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">
         Cette fonctionnalit√© g√©n√®re une vid√©o √† partir de texte en utilisant Stable Diffusion WebUI et des mod√®les Dreambooth.
     </p>
     <form id="text-to-video-form">
         <fieldset>
             <legend>Texte</legend>
             <label>
                 Texte √† convertir en vid√©o :
                 <textarea name="text" id="text-to-video-input" rows="5" style="width: 100%; padding: 8px; font-family: inherit;" placeholder="Entrez le texte ici..."></textarea>
             </label>
         </fieldset>
         <fieldset>
             <legend>Personnage (optionnel)</legend>
             <label>
                 S√©lectionner un personnage :
                 <select name="character_id" id="text-to-video-character" style="width: 100%; padding: 8px;">
                     <option value="">Aucun personnage</option>
                 </select>
             </label>
             <p style="font-size: 0.9em; color: #666; margin-top: 5px;">
                 Les personnages entra√Æn√©s seront automatiquement utilis√©s dans la g√©n√©ration.
             </p>
         </fieldset>
         <fieldset>
             <legend>Param√®tres</legend>
             <label>
                 Mod√®le Dreambooth (optionnel, ignor√© si un personnage est s√©lectionn√©) :
                 <input type="text" name="model_name" id="text-to-video-model" placeholder="Nom du mod√®le (laisser vide pour le mod√®le par d√©faut)" style="width: 100%; padding: 8px;">
             </label>
             <label style="margin-top: 10px; display: block;">
                 <input type="checkbox" name="image_per_sentence" id="text-to-video-sentence" checked>
                 G√©n√©rer une image par phrase
             </label>
         </fieldset>
         <fieldset>
             <legend>Dossier (optionnel)</legend>
             <label>
                 Dossier :
                 <select name="folder_path" id="text-to-video-folder">
                     <option value="">Aucun dossier (racine)</option>
                 </select>
             </label>
         </fieldset>
         <fieldset>
             <legend>Confidentialit√©</legend>
             <label>
                 <input type="checkbox" name="is_private" id="text-to-video-private">
                 Fichier priv√© (visible uniquement par les √©diteurs)
             </label>
         </fieldset>
         <button type="submit" id="text-to-video-submit" style="margin-top: 15px; padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
             G√©n√©rer la vid√©o
         </button>
     </form>
     <div id="text-to-video-status" style="margin-top: 15px; padding: 10px; display: none;"></div>
 </section>

 {% if is_editor %}
 <section id="upload" style="display: block;">
     <h2>T√©l√©charger et traiter un fichier</h2>
     <form id="upload-form">
        <fieldset>
            <legend>Type de fichier</legend>
            <label>
                <input type="radio" name="file_type" value="video" checked>
                Vid√©o
            </label>
            <label>
                <input type="radio" name="file_type" value="audio">
                Audio
            </label>
            <label>
                <input type="radio" name="file_type" value="text">
                Texte
            </label>
        </fieldset>
        <fieldset>
            <legend>Dossier (optionnel)</legend>
            <label>
                Dossier :
                <select name="folder_path" id="folder-path-select">
                    <option value="">Aucun dossier (racine)</option>
                </select>
            </label>
        </fieldset>
         <div class="file-upload">
             <label class="file-upload-label" id="file-type-label">Fichier vid√©o :</label>
             <input type="file" name="file" id="video-file" accept="video/*" class="file-upload-input" multiple required>
             <button type="button" class="file-upload-trigger" id="file-upload-button">Choisir un fichier</button>
             <span class="file-upload-name" id="selected-file-name">Aucun fichier s√©lectionn√©</span>
         </div>
         <fieldset id="processing-options-fieldset">
             <legend>Options de traitement</legend>
             <div id="video-options">
                 <label>
                     <input type="checkbox" name="process_options" value="transcribe">
                     Transcrire (vid√©o ‚Üí texte)
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="subs" checked>
                     T√©l√©charger les sous-titres
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="dub_audio" checked>
                     Audio de doublage (MP3)
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="dub_video" checked>
                     Vid√©o avec doublage audio
                 </label>
             </div>
             <div id="audio-options" style="display: none;">
                 <label>
                     <input type="checkbox" name="process_options" value="transcribe" checked>
                     Transcrire (audio ‚Üí texte)
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="improve_text">
                     Am√©liorer le texte (avec IA)
                 </label>
             </div>
             <div id="text-options" style="display: none;">
                 <label>
                     <input type="checkbox" name="process_options" value="improve_text" checked>
                     Am√©liorer le texte (avec IA)
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="translate" checked>
                     Traduire
                 </label>
                 <label>
                     <input type="checkbox" name="process_options" value="generate_audio">
                     G√©n√©rer audio (texte ‚Üí audio)
                 </label>
             </div>
            <p class="language-hint">D√©cochez les options inutiles pour √©viter un traitement superflu.</p>
         </fieldset>
         <fieldset id="languages-fieldset">
             <legend>Langues cibles (max. 2)</legend>
             {% for lang in available_languages %}
             <label>
                 <input type="checkbox" name="languages" value="{{ lang.code }}">
                 {{ lang.label }}{% if lang.provider == "ai" %}*{% endif %}
             </label>
             {% endfor %}
             <p class="language-hint">Les langues marqu√©es d'un * utilisent le traducteur IA, les autres passent par DeepL.</p>
             <p class="language-hint">Lingala, Tshiluba, Kikongo et Malagasy ne proposent pour l'instant que des sous-titres.</p>
         </fieldset>
         <fieldset id="source-language-fieldset" style="display: none;">
             <legend>Langue source</legend>
             <label>
                 Langue du fichier :
                 <select name="source_language" id="source-language-select">
                     <option value="fr">Fran√ßais</option>
                     <option value="nl">N√©erlandais</option>
                     <option value="en">Anglais</option>
                     <option value="es">Espagnol</option>
                     <option value="pt">Portugais</option>
                 </select>
             </label>
         </fieldset>
        <fieldset id="tts-speed-fieldset">
            <legend>Synchronisation du doublage</legend>
            <label>
                Vitesse relative de la voix TTS
                <input
                    type="number"
                    name="tts_speed_multiplier"
                    value="1.05"
                    min="0.8"
                    max="1.2"
                    step="0.01"
                >
            </label>
            <p class="language-hint">
                1,00 = vitesse normale. Augmentez l√©g√®rement (ex. 1,05) pour que la voix doubl√©e d√©marre plus t√¥t.
            </p>
        </fieldset>
        <fieldset id="thumbnail-fieldset" style="display: none;">
            <legend>Miniature/Omslagfoto (optionnel)</legend>
            <p class="language-hint" style="margin-bottom: 15px;">
                Choisissez une miniature pour la vid√©o : extraire un moment de la vid√©o ou t√©l√©charger une image.
            </p>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 10px;">
                    <input type="radio" name="thumbnail_source" value="video_frame" id="thumbnail-video-frame" checked>
                    Extraire un moment de la vid√©o
                </label>
                <div id="video-frame-selector" style="margin-left: 25px; margin-top: 10px; display: block;">
                    <label>
                        Temps (secondes) :
                        <input type="number" id="thumbnail-time" name="thumbnail_time" value="0" min="0" step="0.1" style="width: 100px; padding: 5px;">
                    </label>
                    <button type="button" id="preview-frame-btn" style="margin-left: 10px; padding: 5px 15px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer;">
                        Aper√ßu
                    </button>
                    <div id="frame-preview" style="margin-top: 10px; display: none;">
                        <img id="frame-preview-img" src="" alt="Frame preview" style="max-width: 300px; border: 1px solid #ddd; border-radius: 3px;">
                    </div>
                </div>
            </div>
            <div>
                <label style="display: block; margin-bottom: 10px;">
                    <input type="radio" name="thumbnail_source" value="upload" id="thumbnail-upload">
                    T√©l√©charger une image
                </label>
                <div id="thumbnail-upload-container" style="margin-left: 25px; margin-top: 10px; display: none;">
                    <input type="file" id="thumbnail-file" name="thumbnail_file" accept="image/*" style="padding: 5px;">
                    <div id="thumbnail-preview" style="margin-top: 10px; display: none;">
                        <img id="thumbnail-preview-img" src="" alt="Thumbnail preview" style="max-width: 300px; border: 1px solid #ddd; border-radius: 3px;">
                    </div>
                </div>
            </div>
        </fieldset>
        <button type="submit">T√©l√©verser et traiter</button>
    </form>
     <div id="upload-status"></div>
 </section>
 {% else %}
 <section id="upload" style="display: none;"></section>
 {% endif %}
 
 <hr>
 
 <section id="library">
     <h2>Biblioth√®que</h2>
     <div id="video-list"></div>
     {% if is_editor %}
     <div id="folder-management" style="margin-top: 20px;">
         <button type="button" id="create-folder-btn">Cr√©er un nouveau dossier</button>
     </div>
     {% endif %}
     
     <!-- Message to Admin Section (for viewers and editors) -->
     <!-- Admin Messages Section -->
     {% if can_read_admin_messages %}
     <div id="admin-messages-section" style="margin-top: 30px; padding: 20px; border: 2px solid #dc3545; background: #f8d7da; border-radius: 5px;">
         <h3>üì¨ Messages re√ßus (de I-tech et les saints du MAI)</h3>
         <div id="admin-messages-list" style="margin-top: 15px;">
             <p>Chargement des messages...</p>
         </div>
     </div>
     {% endif %}
 </section>
 
 <section id="player">
     <h2>Lecteur</h2>
     <div id="video-container">
         <video id="video-player" controls width="800">
             Votre navigateur ne supporte pas la balise vid√©o.
         </video>
         <div id="subtitle-overlay" class="hidden"></div>
     </div>
     <div id="player-actions">
         <button type="button" id="fullscreen-button">[ ] Plein √©cran</button>
     </div>
     <div id="player-info"></div>
 </section>
 
 <!-- Message to Admin Section (moved to bottom) -->
 {% if not can_read_admin_messages %}
 <section id="message-to-admin-section" style="margin-top: 30px; padding: 20px; border: 2px solid #ffc107; background: #fff3cd; border-radius: 5px;">
     <h3>üìß Signaler un probl√®me √† l'admin</h3>
     <p style="color: #856404; margin-bottom: 15px;">Vous pouvez envoyer un message √† l'administrateur pour signaler un probl√®me ou poser une question.</p>
     <form id="message-to-admin-form">
         <textarea id="admin-message-input" rows="4" style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 3px;" placeholder="D√©crivez votre probl√®me ou question..."></textarea>
         <button type="submit" style="padding: 10px 20px; background: #ffc107; color: #000; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
             Envoyer le message
         </button>
     </form>
     <div id="message-status" style="margin-top: 10px; display: none;"></div>
 </section>
 {% endif %}
 
 <script src="/static/app.js"></script>
 </body>
 </html>
